### Slog: Data-Parallel Deductive Programming

![CI](https://github.com/harp-lab/slog-lang/workflows/CI/badge.svg)

Slog is a language, compiler, and runtime system for implementing
data-parallel deductive programming.

## Components

- `compiler/`         -- Compiler from Slog source code to a parallel RA plan
- `backend/`          -- MPI-based parallel relational algebra plan (RA) runtime
- `slog/`             -- Python code for interacting with Slog:
- `slog/protobufs/`   -- Wire-level protocol
- `slog/daemon/`      -- Server for managing, queuing, and storing Slog jobs
- `slog/repl/`        -- Interactive CLI for Slog

## Building and Executing

![cli](./cli.gif)

## Using Docker

First, build the Docker image and start up the server:

```sh
docker build --tag slog .
docker run --name=slog --entrypoint=/slog/slog-server --rm --detach slog
```

You may want to run with `--network=host` to expose all the Slog ports to your
host.

### Using the REPL from inside the container

In a separate terminal:
```sh
docker exec --interactive --tty slog bash
./slog-repl
```

### Running scripts from outside the container

First, install the Python dependencies:

```sh
pip install -r requirements.txt
```

Then:

```sh
./runslog 127.0.0.1 tests/tc.slog
```

If you ran without `--network=host`, you can find the container's IP like so:

```sh
docker container inspect slog --format '{{.NetworkSettings.IPAddress}}'
```

## Another way to setup slog

Open Terminal -> Download slog repo using the git repo (https://github.com/harp-lab/slog.git)

Using Docker desktop application:

         1.    Install Docker desktop application using https://docs.docker.com/desktop/
         
         2.    Place the downloaded file in Applications folder(if on mac). Double-click on the the downloaded .dmg file to get started.
         
         3.    Go to Terminal -> cd to slog directory
         
         # Create docker image

         docker build -t slog-daemon .

         docker run -d --name slog-server slog-daemon
         
         # keep two terminals open and change the current directory to the directory where slog is installed.

         One terminal to run the slog-server and another to run the slog-repl
          
         # To Up the slog-server

         docker exec -it slog-server bash

         ./slog-server
         
         # To go onto the REPL

         docker exec -it slog-server bash

         ./slog-repl

         4.   Work on the programs / slog-repl as required

## Docker Volume for Storing Slog Files

Storing Slog files directly in a Docker container is not a good idea, because data written to a container will be lost if that container is deleted or replaced with an update. Docker volumes are the recommended way to persist data generated by and used by Docker containers.

You can create and manage Docker volumes using Docker CLI commands. Here's how you can create a volume and use it with Slog.

First, create a Docker volume. This volume will be used to persistently store your Slog files. You can create a Docker volume by running the following command:

```bash
docker volume create slog-volume
```

After creating the volume, you can run your Docker container and mount the volume in the container. Replace `<path_in_container>` with the path where you want to store the Slog files in the container. This will start the Slog server and the Slog files will be stored in the Docker volume.

```bash
docker run --name=slog --entrypoint=/slog/slog-server -v slog-volume:<path_in_container> --rm --detach slog
```

Now you can use the REPL from inside the container and write Slog files. These files will be stored in the Docker volume and will persist even if the container is deleted.

```bash
docker exec --interactive --tty slog bash
./slog-repl
```

Note: You can check the data in your Docker volume at any time by inspecting the volume. To inspect the volume, you can use the following command:

```bash
docker volume inspect slog-volume
```

This command will give you a JSON output showing details about the volume, including the location on the Docker host where the volume's data is stored.

Keep in mind that if you want to access the data outside the container or if you want to share the volume across different machines, you might consider using a bind mount instead of a Docker volume. A bind mount can be created by specifying a file or directory on the Docker host that you want to share with the container.

## Using a Bind Mount for Storing Slog Files

Bind mounts have limited functionality compared to volumes. They rely on the host machine's filesystem having a certain directory structure available. However, if you want to store Slog files directly on your host machine's filesystem for easier access or for sharing with other containers, you can use a bind mount.

Choose a directory on your host machine where you want to store the Slog files. Let's say this directory is /host/path/to/slog-files.

Run your Docker container and mount the directory in the container. Replace <path_in_container> with the path where you want to store the Slog files in the container.


```bash
docker run --name=slog --entrypoint=/slog/slog-server -v /host/path/to/slog-files:<path_in_container> --rm --detach slog
```

This command binds the host machine's directory /host/path/to/slog-files to `<path_in_container>` in the container. Any changes to `<path_in_container>` will reflect in /host/path/to/slog-files on the host machine.

Now you can use the REPL from inside the container and write Slog files. These files will be stored in the host machine's directory and can be accessed directly from your host machine.

```bash
docker exec --interactive --tty slog bash
./slog-repl
```

Remember, if the directory /host/path/to/slog-files doesn't exist on the host machine, Docker won't automatically create it for you. You must ensure that it exists before you start the container.

Also, the host directory is, by default, readable, writable, and executable by all users (rwxrwxrwx). If you want to change this, you can provide the :ro option to make it read-only, or change the file permissions on the host directory.

## Common issues on setup & how to solve
  - Windows
	  - <strong>WSL</strong>:
		  - Docker has issues running on WSL if you are using a Linux Distribution running on WSL 1. To check your distribution version run
		  - ``wsl -l -v``
		  - If your main distribution (denoted by the asterisk) is version 1, upgrade it using 
		  - ``wsl --set-version <distro name> 2``
		  - Restart your terminal and try Docker again


         
